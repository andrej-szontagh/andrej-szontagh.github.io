const t=1.61803398875,e=Math.sqrt(t);class n{constructor(){var t=this}static isInViewport(t,e){let n=window.innerHeight,o=t.getBoundingClientRect(),i=n*Math.min(e,.4),s=o.top-i,r=o.bottom-i;return!(s>(n-=2*i)||r<0)}static forEachArray(t,e){if(t)for(let n=0;n<t.length;n++)if(e(t[n],n))return}static forEachNodeList(t,e){if(t)for(let n=0;n<t.length;n++)if(e(t.item(n),n))return}static forEachObject(t,e){let n=0;for(var o in t)if(t.hasOwnProperty(o)&&e(o,t[o],n++))return}static loadJSON(t,e){let n=new XMLHttpRequest;n.overrideMimeType("application/json"),n.open("GET",t,!0),n.onreadystatechange=function(){4===n.readyState&&200===n.status&&e(JSON.parse(n.responseText))},n.send(null)}static hashCode(t){let e=0,n,o;for(n=0;n<t.length;n++)e=(e<<5)-e+(o=t.charCodeAt(n)),e|=0;return e}}const o=Object.freeze({PLAYING:Symbol("onplaying")}),i=Object.freeze({[o.PLAYING]:"onplaying"});class s extends Event{constructor(t,e){var n;super(t),this.player=e}}class r{constructor(){let t=this;t.events=document.createElement("div"),t.initialized=!1,t.sealed=!1,t.queue=[]}dispatchEvent(t){let e;this.events.dispatchEvent(t)}addEventListener(t,e){let n;this.events.addEventListener(t,e)}removeEventListener(t,e){let n;this.events.removeEventListener(t,e)}init(){let t;this.initialized=!0}addPlayer(t,e,n,o){let i=this;i.sealed||i.queue.push({id:t,container:e,start:n,callback:o})}createPlayers(){let t=this;t.initialized&&(t.sealed=!0)}}class a extends r{constructor(){super();let t=this;t.players=[],t.apiready=!1}init(){let t=this;if(!1===t.initialized){t.initialized=!0;let e=document.createElement("script");e.id="iframe-api",e.src="https://www.youtube.com/iframe_api";let n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n)}}createPlayers(){let t=this;t.sealed=!0,t.initialized&&t.apiready&&t._initPlayersRecursive()}_initPlayersRecursive(){let t=this;if(t.queue.length>0){let e=t.queue.shift(),n=new YT.Player(e.container.id,{width:640,height:360,videoId:e.id,playerVars:{enablejsapi:1,loop:1,start:e.start,playlist:e.id,autoplay:1,controls:0,showinfo:0,fs:0,rel:0,disablekb:1,modestbranding:1,playsinline:1},events:{onReady(t){let n=t.target;n.mute(),n.setPlaybackQuality("small"),n.playVideo(),e.callback(n)},onStateChange(t){a.printState(t)},onError(t){a.printError(t)}}});t.players.push(n),n.addEventListener("onStateChange",function e(n){n.data===YT.PlayerState.PLAYING&&t.dispatchEvent(new s(i[o.PLAYING],n.target))}),t.addEventListener(i[o.PLAYING],function e(n){n.target.removeEventListener(n.type,e),setTimeout(function(){t._initPlayersRecursive()},1e3)})}}static printState(t){let e,n=t.target.getIframe();switch(t.data){case YT.PlayerState.BUFFERING:case YT.PlayerState.PLAYING:}}static printError(t){const e={2:"YouTube API error 2",5:"YouTube API error 5",100:"YouTube API error 100",101:"YouTube API error 101",150:"YouTube API error 150"};t.data in e&&console.log(e[t.data])}debug(){let t=this;const e={[YT.PlayerState.ENDED]:"ended",[YT.PlayerState.PLAYING]:"playing",[YT.PlayerState.PAUSED]:"paused",[YT.PlayerState.BUFFERING]:"buffering",[YT.PlayerState.CUED]:"cued"};t.players.forEach(function(t,n){let o=t.getPlayerState();o=o in e?e[o]:"unstarted",console.log("Player "+n+" >> "+o)})}}function onYouTubeIframeAPIReady(){S.apiready=!0,S.initialized&&S.sealed&&S.createPlayers()}class l{constructor(){let t=this;t.content_overflow=document.getElementById("content-overflow"),t.content_transform=document.getElementById("content-transform"),t.content=document.getElementById("content"),t.gallery=new m("data/gallery.json")}}class c extends l{constructor(){super();let t=this;t.crop_scrolltop=0,t.cropped=!1}cropIn(t,e){let n=this,o=n.content_transform.getBoundingClientRect();n.crop_scrolltop=document.scrollingElement.scrollTop,n.content_transform.style.height="calc(100vh + "+(t+e)+"px)",n.content.style.top=-(n.crop_scrolltop-t)+"px",document.scrollingElement.scrollTop=t,T.classList.add("has-crop"),n.cropped=!0}cropOut(){let t=this;t.content_transform.style.height=null,t.content.style.top=null,document.scrollingElement.scrollTop=t.crop_scrolltop,T.classList.remove("has-crop"),t.crop_scrolltop=-1,t.cropped=!1}}class d extends c{constructor(){super();let t=this;function e(e){if(t.zoomed_at){let e=t.zoomed_at;t.content_transform.style.transition="none",t.zoomOut();let n=t.content_transform.getBoundingClientRect(),o=e.getBoundingClientRect(),i=window.innerHeight,s=window.innerWidth;document.documentElement.scrollTop=o.top-n.top-.5*(i-o.height),t.zoomIn(e),t.content_transform.style.transition=null}}t.zoomed_at=null,t.zooming=!1,window.addEventListener("resize",function(n){t.content.addEventListener("layoutComplete",function t(n){n.target.removeEventListener(n.type,t),requestAnimationFrame(function(){e(n)})})})}zoomIn(t,n){let o=this,i=window.innerHeight,s=window.innerWidth,r=t.getBoundingClientRect(),a=r.top<0?-r.top:0,l=r.bottom>i?r.bottom-i:0;o.cropIn(a,l);let c=r.left+.5*r.width,u=r.top+.5*r.height,m=e,p=m*r.width/s,g=m*r.height/i,h=Math.max(s*Math.max(.75,p)/r.width,i*Math.max(.75,g)/r.height),_=.5*s-c,f=.5*i-u,v=5;u+=a,o.content_transform.style.transform="translateX("+_+"px) translateY("+f+"px) scale("+h+") rotate(5deg)",o.content_transform.style.transformOrigin=c+"px "+u+"px ",d._playAnimation(o.content_transform,"focusing","focusing",null),T.classList.add("has-zoom"),o.zoomed_at=t,o.zooming=!0,n?(T.classList.add("is-zooming-in"),d._onTransitionEnd(o.content_transform,"transform",function(t){T.classList.remove("is-zooming-in"),o.zooming=!1,n(t)})):o.zooming=!1}zoomOut(t){let e=this;e.zoomed_at&&(e.content_transform.style.transform=null,d._playAnimation(e.content_transform,"focusing","focusing",null)),e.zooming=!0,t?(T.classList.add("is-zooming-out"),d._onTransitionEnd(e.content_transform,"transform",function(n){e.zooming=!1,e.zoomed_at=null,T.classList.remove("is-zooming-out"),T.classList.remove("has-zoom"),e.cropOut(),t(n)})):(e.zooming=!1,e.zoomed_at=null,T.classList.remove("has-zoom"),e.cropOut())}static _playAnimation(t,e,n,o){t.classList.add(e),d._onAnimationEnd(t,n,function(n){t.classList.remove(e),o&&o(n)})}static _onAnimationEnd(t,e,n){t.addEventListener("animationend",function o(i){i.target===t&&i.animationName===e&&(i.target.removeEventListener(i.type,o),n&&n(i))})}static _onTransitionEnd(t,e,n){t.addEventListener("transitionend",function o(i){i.target===t&&i.propertyName===e&&(i.target.removeEventListener(i.type,o),n&&n(i))})}}class u extends d{constructor(){super()}}class m{constructor(t){let e=this;e.manager_videos=null,e.manager_images=null,e.lightbox=null,e.desc=document.getElementById("label-description"),e.container=document.getElementById("content-transform"),e.desc_header=e.desc.querySelector("h1"),e.desc_oneliner=e.desc.querySelector("p"),e.desc_tags=e.desc.querySelector("h3"),n.loadJSON(t,function(t){e.json=t,e.manager_videos=new p(document.getElementById("gallery-videos"),t),e.manager_images=new g(document.getElementById("gallery-images"),t,function(){e.updateButtons()}),e.lightbox=new h(t),e.updateButtons()})}updateButtons(){let t=this;function e(e){t.onOpen(e)}function o(e){t.onVisible(e)}n.forEachNodeList(document.querySelectorAll(".gallery-block"),function(t,n){!1===t.classList.contains("button-hover")&&(t.classList.add("button-hover"),t.classList.add("hidden"),t.setAttribute("button-target","<this> #label-description"),t.setAttribute("button-clear",".gallery-block"),t.addEventListener("onvisible",o),t.___callback_open=e)}),z.updateButtons()}static getDescriptor(t,e){return e in t.images?t.descriptions[t.images[e].description]:e in t.videos?t.descriptions[t.videos[e].description]:null}buildTagsString(t){let e="";return n.forEachObject(t,function(t,n,o){o>0&&(e+=" - "),e+=n}),e}onVisible(t){let e=this,n=m.getDescriptor(e.json,t.target.id);n?(e.desc_header.innerHTML=n.name+"<br> ("+n.year+")",e.desc_oneliner.innerHTML=n.oneliner,e.desc_tags.innerHTML="",n.tags&&(e.desc_tags.innerHTML=e.buildTagsString(n.tags))):(e.desc_header.innerHTML="",e.desc_oneliner.innerHTML="",e.desc_tags.innerHTML="")}onOpen(t){let e=this;!1===A.zooming&&(e.lightbox.isVisible()?e.lightbox.hide():e.lightbox.show(t.target))}}class p{constructor(t,e){let o=this;o.container=t,n.forEachObject(e.videos,function(t,n,i){let s=o.appendVideoDOM(t,i+1,e.filebase_covers+n.cover);s.progressbar_img.addEventListener("load",function(t){o.startBuffering(s)}),S.addPlayer(t,s.placeholder,n.start,function(t){o.initPlayer(s,t)})}),S.createPlayers()}initPlayer(t,e){let s=this;function r(){t.cover.classList.contains("hidden")&&(n.isInViewport(t.wrapper,0)?s.playPlayer(t,e):s.pausePlayer(t,e))}window.addEventListener("resize",r),window.addEventListener("scroll",r),S.addEventListener(i[o.PLAYING],function e(n){n.target.removeEventListener(n.type,e),s.finishBuffering(t,function(){s.playPlayer(t,n.player)})&&n.player.pauseVideo()})}playPlayer(t,e){var o=this;n.isInViewport(t.wrapper,0)&&(e.playVideo(),t.wrapper.style.visibility="visible")}pausePlayer(t,e){var n=this;e.pauseVideo(),t.wrapper.style.visibility="hidden"}startBuffering(t){var e=this;let n=parseFloat(t.progressbar.getAttribute("index"));t.progressbar.style.setProperty("--progress","98%"),t.progressbar.style.transitionDelay=(1+Math.random())*n+"s",t.progressbar.style.transitionDuration=20+10*Math.random()+"s"}finishBuffering(t,e){var n=this;return!0===t.cover.classList.contains("visible")&&(t.progressbar.style.setProperty("--progress","100%"),t.progressbar.style.transitionDuration="0.5s",t.progressbar.style.transitionDelay=null,t.cover.classList.remove("visible"),t.progressbar.addEventListener("transitionend",function n(o){o.target!==t.progressbar||"clip-path"!==o.propertyName&&"width"!==o.propertyName||(o.target.removeEventListener(o.type,n),e&&e(),setTimeout(function(){t.cover.classList.add("hidden")},100))}),!0)}appendVideoDOM(t,e,n){let o=this,i={wrapper:document.createElement("div"),placeholder:document.createElement("div"),cover:document.createElement("div"),cover_img:document.createElement("img"),progressbar:document.createElement("div"),progressbar_img:document.createElement("img")};return i.progressbar.setAttribute("index",e),i.wrapper.id=t,i.placeholder.id="YouTube-"+t,i.wrapper.className="video-wrapper gallery-block",i.placeholder.className="youtube-player",i.cover.className="video-cover visible",i.progressbar.className="video-progressbar",i.cover_img.src=n,i.progressbar_img.src=n,i.cover.appendChild(i.cover_img),i.cover.appendChild(i.progressbar),i.progressbar.appendChild(i.progressbar_img),i.wrapper.appendChild(i.cover),i.wrapper.appendChild(i.placeholder),o.container.appendChild(i.wrapper),i}}class g{constructor(t,e,o){let i=this;function s(t){if(t<i.loadstack.length){let n=i.loadstack[t].id,r=e.filebase_images+n,a=r.split(".").slice(0,-1).join("."),l,c=a+"_tumbnail"+r.substring(a.length,r.length),d=r;i.addImage(n,c,d,function(){o(),s(++t)})}}i.json=e,i.container=t,i.layout=new Masonry("#gallery-images",{itemSelector:".gallery-block",columnWidth:".gallery-block",percentPosition:!0,transitionDuration:0,stagger:0,resize:!0}),i.layout.on("layoutComplete",function(t){A.content&&A.content.dispatchEvent(new Event("layoutComplete",{detail:t}))}),i.loadstack=[],n.forEachObject(e.images,function(t,e,n){i.loadstack.push({id:t,data:e})}),s(0)}addImage(t,e,n,o){let i=this,s=document.createElement("div"),r=document.createElement("img");s.id=t,s.className="gallery-block",r.setAttribute("src",e),r.setAttribute("src-lightbox",n),r.setAttribute("srcset",e+" 500w, "+n+" 1000w"),s.appendChild(r),i.container.appendChild(s),r.addEventListener("load",function(t){i.layout.appended(t.target.parentNode),i.layout.layout(),o()}),r.addEventListener("error",function(t){t.target.remove(),i.layout.layout(),o()})}}class h{constructor(t){let e=this;e.json=t,e.container=document.getElementById("screen-lightbox"),e.details=e.container.querySelector("#details"),e.details_timer=null,e.details_index=0,e.target=null,e.container.addEventListener("onvisible",function(t){e.onVisible()}),e.container.addEventListener("onhidden",function(t){e.onHidden()})}resetDetails(){let t=this;t.details_timer&&clearTimeout(t.details_timer),t.details.style.visibility="hidden",t.details.innerHTML="",t.details_index=0}playDetails(t,e,o){let i=this;i.resetDetails();let s=m.getDescriptor(i.json,t);if(s){let t,r,a,l;l=function(){i.details_index>=s.details.length&&(i.details_index=0);let t=s.details[i.details_index++],e="";n.forEachObject(t,function(t,n,o){e+=n}),i.details.innerHTML=e,i.details.style.visibility="visible"},t=function(e){e.target.removeEventListener(e.type,t),i.details_timer&&clearTimeout(i.details_timer),i.details_timer=setTimeout(a,o)},r=function(e){e.target.removeEventListener(e.type,r),i.details.classList.remove("roll-off"),i.details.classList.add("roll-on"),i.details.addEventListener("animationend",t),l()},a=function(){i.details.classList.remove("roll-on"),i.details.classList.add("roll-off"),i.details.addEventListener("animationend",r)},i.details_timer=setTimeout(a,e)}}onVisible(){let t=this;t.target&&(A.zoomIn(t.target,function(t){}),A.zoomed_at&&(A.zoomed_at.classList.add("in-lightbox"),t.playDetails(A.zoomed_at.id,0,2e3)))}onHidden(){let t=this;A.zoomed_at&&A.zoomed_at.classList.remove("in-lightbox"),A.zoomOut(function(e){t.resetDetails()})}isVisible(t){let e;return this.container.classList.contains("visible")}show(t){let e=this;e.target=t,e.container.classList.remove("hidden"),e.container.classList.add("visible"),e.container.dispatchEvent(new Event("onvisible"))}hide(){let t=this;t.container.classList.remove("visible"),t.container.classList.add("hidden"),t.container.dispatchEvent(new Event("onhidden"))}}class _{constructor(){let t=this;t.touch=!1,t.ui=document.getElementById("ui"),window.addEventListener("touchstart",function e(){t.touch=!0,t.updateButtons(),window.removeEventListener("touchstart",e,!1)},!1),t.updateButtons()}updateButtons(){let t=this;n.forEachNodeList(T.querySelectorAll(".button-hover, .button-press"),function(e,n){t.touch?t.transformButton(e):t.initButton(e)})}initButton(t){let e=this;null===t.getAttribute("button-state")&&t.setAttribute("button-state","off"),!1===t.classList.contains("hidden")&&!1===t.classList.contains("visible")&&t.classList.add("visible")}transformButton(t){let e=this;t.classList.contains("button-hover")&&(e.clearButtonEvents(t),t.classList.remove("button-hover"),t.classList.add("button-press"),e.initButton(t))}transformButtonByScrolls(t){let e=this;if(t.classList.contains("button-hover")){let o=t.getAttribute("button-scroll");if(null!==o){let i=window.innerHeight;n.forEachNodeList(T.querySelectorAll(o),function(n,o){let s;if(n.getBoundingClientRect().height>i)return e.transformButton(t),!0})}}}}const f=Object.freeze({ON:Symbol("on"),OFF:Symbol("off")}),v=Object.freeze({[f.ON]:"on",[f.OFF]:"off"});class b extends _{constructor(){super()}setButtonState(t,e,o=!0){let i=this;function s(e,i){if(!0===o){let o=t.getAttribute(e);null!==o&&n.forEachNodeList(T.querySelectorAll(o),function(e,n){e!==t&&i(e)})}}if(t.classList.contains("button-hover")||t.classList.contains("button-press")){let n=b._parseButtonState(t),o=v[e];n.value_readonly||t.setAttribute("button-state",o),s("button-clear",function(t){i.getButtonState(t)===f.ON&&i.setButtonState(t,f.OFF,!1)}),s("button-set-"+o,function(t){i.setButtonState(t,e,!1)}),i.showButtonTargets(t,"button-target",e)}}getButtonState(t){let e=this,n=b._parseButtonState(t);if(null!==n.value_ext){let t=T.querySelector(attr);t&&(n=b._parseButtonState(t))}return n.value}showButtonTargets(t,e,n){}static _checkBracets(t,e,n){return(t=t.trim()).length>0&&t.charAt(0)===e&&t.charAt(t.length-1)===n?{contained:!0,modified:t=(t=t.substring(1,t.length-1)).trim()}:{contained:!1,modified:t}}static _parseButtonState(t){let e={value:null,value_ext:null,value_readonly:!1},n=t.getAttribute("button-state");if(n){let t;t=b._checkBracets(n,"[","]"),e.value_readonly=t.contained,e.value="on"===t.modified?f.ON:f.OFF,t=b._checkBracets(t.modified,"{","}"),e.value_ext=t.contained?t.modified:null}return e}}class y extends b{constructor(){super()}showButtonTargets(t,e,n){super.showButtonTargets(t,e,n);let o=this,i=t.getAttribute(e);if(i){let e=[],o=(i=i.trim()).length;if((i=y._cutoffToken(i,"<this>")).length!==o&&e.push(t),i){let t=T.querySelectorAll(i);t&&(e=e.concat(Array.prototype.slice.call(t)))}null!=e&&e.forEach(function(t,e){y._showTargetByState(t,n)})}}static _cutoffToken(t,e){let n=t.indexOf(e);return n>=0&&(t=(t=t.substr(0,n)+t.substr(n+e.length)).trim()),t}static _showTargetByState(t,e){e===f.ON?y._showTarget(t):y._hideTarget(t)}static _showTarget(t){t.classList.remove("hidden"),t.classList.add("visible"),t.dispatchEvent(new Event("onvisible"))}static _hideTarget(t){t.classList.remove("visible"),t.classList.add("hidden"),t.dispatchEvent(new Event("onhidden"))}}class E extends y{constructor(){super()}initButton(t){super.initButton(t);let e=this;e.clearButtonEvents(t),t.classList.contains("button-hover")?(t.___button_listener_mouseleave=function(t){clearTimeout(t.target.___button_listener_mouseenter_timeout),e.setButtonState(t.target,f.OFF)},t.___button_listener_mouseenter=function(t){function n(){e.setButtonState(t.target,f.ON),e.transformButtonByScrolls(t.target)}clearTimeout(t.target.___button_listener_mouseenter_timeout),t.target.___button_listener_mouseenter_timeout=setTimeout(n,100)},t.___button_listener_mousedown=function(t){t.target.___callback_open&&t.target.___callback_open(t)},t.addEventListener("mouseenter",t.___button_listener_mouseenter),t.addEventListener("mouseleave",t.___button_listener_mouseleave),t.addEventListener("mousedown",t.___button_listener_mousedown)):t.classList.contains("button-press")&&(t.___button_listener_mousedown=function(t){let n=t.target,o=e.getButtonState(n);o===f.ON?e.setButtonState(n,f.OFF):o===f.OFF&&e.setButtonState(n,f.ON)},t.___button_listener_mouseup=function(t){let e=(new Date).getTime();if(t.target.___callback_open&&t.target.___button_listener_mouseup_time){let n=e-t.target.___button_listener_mouseup_time;n>100&&n<500&&t.target.___callback_open(t)}t.target.___button_listener_mouseup_time=e},t.addEventListener("mousedown",t.___button_listener_mousedown),t.addEventListener("mouseup",t.___button_listener_mouseup)),t.___callback_open||(t.___callback_open=function(t){})}clearButtonEvents(t){t.removeEventListener("mouseenter",t.___button_listener_mouseenter),t.removeEventListener("mouseleave",t.___button_listener_mouseleave),t.removeEventListener("mousedown",t.___button_listener_mousedown),t.removeEventListener("mouseup",t.___button_listener_mouseup)}}class L extends E{constructor(){super()}}class w{constructor(){let t=this;t.initEmailBanner(),t.initBodyTagSystem(),t.initScrollReset(),t.initScrollCSSVar()}initEmailBanner(){let t=this,e=T.querySelector("#button-contact"),n=T.querySelector("#label-email"),o="andrej",i="szontagh",s="gmail",r="com";e.href="mailto:andrej.szontagh@gmail.com",n.innerHTML="andrej​.​szontagh ​@ ​gmail​.​com"}initBodyTagSystem(){let t=this,e={screen:"has-screen"},o="",i=0;function s(t){n.forEachObject(e,function(e,n,o){t.target.classList.contains(e)&&T.classList.remove(n)})}function r(t){n.forEachObject(e,function(e,n,o){t.target.classList.contains(e)&&T.classList.add(n)})}n.forEachObject(e,function(t,e,n){n>0&&(o+=", "),o+="."+t}),n.forEachNodeList(document.querySelectorAll(o),function(t,e){t.addEventListener("onhidden",s,!1),t.addEventListener("onvisible",r,!1)})}initScrollReset(){let t=this;function e(t){let e=t.target.querySelector(".scroll");e&&(e.parentNode.scrollTop=0)}n.forEachNodeList(document.querySelectorAll(".screen"),function(t,n){t.addEventListener("onvisible",e,!1)})}initScrollCSSVar(){let t=this;n.forEachNodeList(document.querySelectorAll(".scroll"),function(t,e){let n=window.getComputedStyle(t),o=n.getPropertyValue("--scroll-pos-min"),i=n.getPropertyValue("--scroll-pos-max");o=o?parseFloat(o):0,i=i?parseFloat(i):1;let s=function e(n){let s=window.innerHeight,r=t.getBoundingClientRect(),a=r.height>s?Math.abs(r.top)/(r.height-s):0;a=Math.min(Math.max((a-o)/(i-o),0),1),t.style.setProperty("--scroll-pos",a)};t.parentNode.addEventListener("scroll",s)})}}let B=new n,S=new a,T=null,z=null,P=null,A=null;window.onload=function(t){T=document.getElementsByTagName("BODY")[0],S.init(),z=new L,P=new w,A=new u};